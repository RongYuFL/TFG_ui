# GENEFACEPLUSPLUS è¯´è¯äººè„¸ç”Ÿæˆå¯¹è¯ç³»ç»Ÿ

## é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªé›†æˆäº†ASRï¼ˆè¯­éŸ³è¯†åˆ«ï¼‰ã€LLMï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰ã€TTSï¼ˆè¯­éŸ³åˆæˆï¼‰å’ŒRVCï¼ˆè¯­éŸ³å…‹éš†ï¼‰çš„å®æ—¶äººæœºå¯¹è¯ç³»ç»Ÿã€‚

ç”¨æˆ·å¯ä»¥é€šè¿‡ç½‘é¡µå½•åˆ¶è‡ªå·±çš„å£°éŸ³ï¼Œåç«¯å°†è‡ªåŠ¨è¯†åˆ«è¯­éŸ³å†…å®¹ï¼Œè°ƒç”¨å¤§æ¨¡å‹ç”Ÿæˆå›å¤ï¼Œç„¶åä½¿ç”¨RVCè¯­éŸ³å…‹éš†æŠ€æœ¯ï¼ˆ`chatterbox-tts`ï¼‰ç”Ÿæˆä¸ç‰¹å®šè§’è‰²ï¼ˆä¾‹å¦‚ `nahida.wav`ï¼‰éŸ³è‰²ä¸€è‡´çš„å›å¤éŸ³é¢‘ï¼Œå¹¶å°†é•¿éŸ³é¢‘æ‹¼æ¥åè¿”å›ç»™å‰ç«¯æ’­æ”¾ã€‚

é¡¹ç›®è¿˜åŒ…å«æ¨¡å‹è®­ç»ƒå’Œé™æ€è§†é¢‘ç”Ÿæˆçš„åŠŸèƒ½ã€‚

## æ ¸å¿ƒæ¨¡å—

* **Flask åç«¯ (`app.py`):** è´Ÿè´£å¤„ç†å‰ç«¯è¯·æ±‚ï¼Œæä¾›ç½‘é¡µæœåŠ¡ï¼Œå¹¶ä½œä¸ºæ‰€æœ‰åç«¯è„šæœ¬çš„â€œç²˜åˆå‰‚â€ã€‚
* **äººæœºå¯¹è¯å¼•æ“ (`backend/chat_engine.py`):** è´Ÿè´£åè°ƒâ€œäººæœºå¯¹è¯â€çš„å®Œæ•´æµç¨‹ï¼Œé€šè¿‡å­è¿›ç¨‹è°ƒç”¨ASRã€LLMå’ŒRVCè„šæœ¬ã€‚
* **ASR+LLM ç®¡é“ (`china_pipeline.py`):**
    * **ASR:** ä½¿ç”¨æ™ºè°±AI (`glm-asr`) å°†ç”¨æˆ·å½•éŸ³ï¼ˆ`aud.wav`ï¼‰è½¬æ¢ä¸ºæ–‡æœ¬ã€‚
    * **LLM:** ä½¿ç”¨æ™ºè°±AI (`glm-4-flash`) æ ¹æ®ASRæ–‡æœ¬ç”ŸæˆAIåº”ç­”ï¼Œå¹¶ä¿å­˜åˆ° `latest_ai_response.txt`ã€‚
* **TTS+è¯­éŸ³å…‹éš† (`RVC.py`):**
    * **TTS:** ä½¿ç”¨ `chatterbox-tts` å°† `latest_ai_response.txt` ä¸­çš„æ–‡æœ¬è½¬æ¢ä¸ºè¯­éŸ³ã€‚
    * **Cloning:** ä½¿ç”¨ `input/audio/nahida.wav` ä½œä¸ºå‚è€ƒéŸ³è‰²ï¼Œç”Ÿæˆå…‹éš†åçš„éŸ³é¢‘ã€‚
* **(å…¶ä»–æ¨¡å—)**
    * **è®­ç»ƒåç«¯ (`backend/model_trainer.py`):** è´Ÿè´£è°ƒç”¨æ¨¡å‹æ‰§è¡Œè®­ç»ƒä»»åŠ¡ã€‚
    * **æ¨ç†åç«¯ (`backend/video_generator.py`):** è´Ÿè´£è°ƒç”¨æ¨¡å‹æ‰§è¡Œè§†é¢‘ç”Ÿæˆæ¨ç†ã€‚

## ç³»ç»Ÿæµç¨‹

### 1. äººæœºå¯¹è¯ (Chat System) æµç¨‹

```mermaid
graph TD
    A[å‰ç«¯: ç”¨æˆ·ç‚¹å‡»â€œå¼€å§‹å½•éŸ³â€] --> B(å‰ç«¯: ç”¨æˆ·è¯´è¯...);
    B --> C[å‰ç«¯: ç”¨æˆ·ç‚¹å‡»â€œåœæ­¢å½•éŸ³â€];
    C --> D[JS: ä¸Šä¼ éŸ³é¢‘ Blobè‡³ /save_audio];
    D --> E[Flask: app.py @ /save_audio];
    E --> F[Pydub: ä¿®å¤å¹¶ä¿å­˜ä¸ºæ ‡å‡† aud.wav];
    
    G[å‰ç«¯: ç”¨æˆ·ç‚¹å‡»â€œå¼€å§‹å¯¹è¯â€] --> H[JS: æäº¤è¡¨å•è‡³ /chat_system];
    H --> I[Flask: app.py @ /chat_system];
    I --> J[è°ƒç”¨ backend/chat_engine.py];
    
    J --> K[Engine: è¿è¡Œ china_pipeline.py];
    K --> L[ASR/LLM: aud.wav -> latest_ai_response.txt];
    
    L --> M[Engine: åˆ‡åˆ†é•¿æ–‡æœ¬];
    M --> N[Engine: å¾ªç¯è°ƒç”¨ RVC.py];
    N --> O[RVC: text_chunk -> chunk_N.wav];
    
    O --> P[Engine: ä½¿ç”¨ pydub æ‹¼æ¥æ‰€æœ‰ chunk_N.wav];
    P --> Q[ä¿å­˜ä¸º static/audios/cloned_output.wav];
    
    Q --> R[Flask: è¿”å› JSON è·¯å¾„];
    R --> S[JS: æ¥æ”¶è·¯å¾„, æ›´æ–° <video> æ ‡ç­¾å¹¶æ’­æ”¾];
```

### 2. è§†é¢‘ç”Ÿæˆ (Video Generation) æµç¨‹
(æ¥è‡ª `app.py` ä¸­çš„ `/video_generation` è·¯ç”±)

```
[ç”¨æˆ·ç‚¹å‡»â€œç”Ÿæˆè§†é¢‘â€æŒ‰é’®]
        â†“
[å‰ç«¯ JS æ•è·è¡¨å•æ•°æ®å¹¶ç”¨ fetch å‘é€ POST è¯·æ±‚]
        â†“
[Flask è·¯ç”±æ¥æ”¶ request.form]
        â†“
[è°ƒç”¨ backend/video_generator.py ä¸­çš„å‡½æ•° generate_video()]
        â†“
[åç«¯å‡½æ•°è¿”å›ç”Ÿæˆè§†é¢‘çš„è·¯å¾„]
        â†“
[Flask æŠŠè·¯å¾„ä»¥ JSON å½¢å¼è¿”å›ç»™å‰ç«¯]
        â†“
[å‰ç«¯ JS æ¥æ”¶åˆ°è·¯å¾„ â†’ æ›¿æ¢ <video> æ ‡ç­¾çš„ src â†’ è‡ªåŠ¨æ’­æ”¾è§†é¢‘]
```

## ç¯å¢ƒé…ç½®ä¸å®‰è£…

### æ­¥éª¤ 1: å…‹éš†é¡¹ç›®

```bash
git clone git@github.com:prummn/genefaceplusplus_ui.git
cd genefaceplusplus_ui
```

### æ­¥éª¤ 2: ã€å…³é”®ã€‘è·å–æ¨¡å‹æ–‡ä»¶

æœ¬é¡¹ç›®ä¾èµ–çš„ RVC è¯­éŸ³å…‹éš†æ¨¡å‹ (`models_zh`) **æœªåŒ…å«**åœ¨ Git ä»“åº“ä¸­ï¼ˆå› ä¸ºæ–‡ä»¶è¿‡å¤§ï¼‰ã€‚

æ‚¨å¿…é¡»é€šè¿‡å…¶ä»–æ–¹å¼ï¼ˆä¾‹å¦‚ç½‘ç›˜ã€Uç›˜ï¼‰å°†è¿™äº›æ–‡ä»¶å¤¹æ‹·è´åˆ°é¡¹ç›®æ ¹ç›®å½•ã€‚

**æ“ä½œï¼š**
1.  æ‰‹åŠ¨**å¤åˆ¶** `models_zh` æ–‡ä»¶å¤¹åˆ°é¡¹ç›®æ ¹ç›®å½•ã€‚


é¡¹ç›®ç»“æ„åº”å¦‚ä¸‹æ‰€ç¤ºï¼š
```
/genefaceplusplus_ui/
|-- app.py
|-- china_pipeline.py
|-- RVC.py
|-- requirements.txt
|-- README.md
|-- backend/
|-- input/
|   |-- audio/              (å‚è€ƒéŸ³è‰²æ–‡ä»¶ç›®å½•)
|       |-- nahida.wav
|       |-- zhb.wav
|   |-- text/               (RVC.pyæµ‹è¯•æ—¶çš„è¾“å…¥æ–‡å­—)
|       |-- nahida.txt
|       |-- text.txt
|-- models_zh/          <-- (éœ€æ‰‹åŠ¨å¤åˆ¶, 5ä¸ªGå·¦å³)
|-- output/             
|   |-- cloned_nahida.wav   (RVC.pyæµ‹è¯•æ—¶çš„è¾“å‡ºéŸ³é¢‘)
|-- static/
|   |-- audio/              
|       |-- cloned_output.wav  (æœåŠ¡å™¨å¼€å¯åRVC.pyçš„è¾“å‡ºéŸ³é¢‘)
|-- templates/
|-- SyncTalk/
|   |-- audio/              (ç½‘é¡µå½•éŸ³ä¿å­˜ç›®å½•ï¼ŒæœåŠ¡å™¨å¼€å¯åchina_pipeline.pyçš„è¾“å…¥éŸ³é¢‘è·¯å¾„)
|-- latest_ai_response.txt  (AIåº”ç­”æ–‡å­—ï¼ŒæœåŠ¡å™¨å¼€å¯åRVC.pyçš„è¾“å…¥æ–‡å­—)
|-- conversation_log.txt    (AIå¯¹è¯å†å²)
```

### æ­¥éª¤ 3: åˆ›å»º Conda ç¯å¢ƒ

`requirements.txt` æ–‡ä»¶æ˜¾ç¤ºæœ¬é¡¹ç›®åœ¨ `Python 3.9` ä¸Šå¼€å‘ã€‚æˆ‘ä»¬å¼ºçƒˆå»ºè®®ä½¿ç”¨ Conda æ¥åˆ›å»ºä¸€ä¸ªéš”ç¦»çš„çº¯å‡€ç¯å¢ƒã€‚

```bash
# 1. åˆ›å»ºä¸€ä¸ªåä¸º geneface_env çš„æ–°ç¯å¢ƒ
conda create -n geneface_env python=3.9 -y

# 2. æ¿€æ´»ç¯å¢ƒ
conda activate geneface_env
```

### æ­¥éª¤ 4: ã€å…³é”®ã€‘å®‰è£…ä¾èµ–

**A. å®‰è£… ffmpeg (ç³»ç»Ÿä¾èµ–)**
`pydub` (ä¿®å¤éŸ³é¢‘) å’Œ `librosa` (è°ƒé€Ÿ) éƒ½éœ€è¦ `ffmpeg`ã€‚

```bash
# (åœ¨ geneface_env ç¯å¢ƒä¸­)
conda install -c conda-forge ffmpeg
```

**B. å®‰è£… PyTorch**
`requirements.txt` åŒ…å«äº†ç‰¹å®š CUDA ç‰ˆæœ¬çš„ `torch` åŒ…ã€‚

```bash
# (åœ¨ geneface_env ç¯å¢ƒä¸­)
pip install torch torchaudio torchvision --index-url [https://download.pytorch.org/whl/cu121](https://download.pytorch.org/whl/cu126)
```

**C. å®‰è£…å…¶ä½™ä¾èµ–**
ç°åœ¨ï¼Œå®‰è£… `requirements.txt` ä¸­å‰©ä½™çš„æ‰€æœ‰åŒ…ã€‚

```bash
# (åœ¨ geneface_env ç¯å¢ƒä¸­)
# æ³¨æ„ï¼šå¦‚æœ requirements.txt ä¸­åŒ…å« --index-urlï¼Œå®ƒä¼šä½¿ç”¨æ¸…åæº
pip install -r requirements.txt
```

### æ­¥éª¤ 5: ã€å…³é”®ã€‘æµ‹è¯• `RVC.py` è„šæœ¬

å•ç‹¬è¿è¡Œ `RVC.py` æ–‡ä»¶ï¼Œæµ‹è¯•å…¶èƒ½å¦åœ¨è¯¥ç¯å¢ƒä¸‹æ­£ç¡®è¿è¡Œã€‚
```
# è¾“å…¥éŸ³é¢‘ã€æ–‡å­—å’Œè¾“å‡ºéŸ³é¢‘è·¯å¾„å·²åœ¨è„šæœ¬ä¸­æŒ‡å®š
python RVC.py
```


## è¿è¡Œé¡¹ç›®

1.  **æ¿€æ´» Conda ç¯å¢ƒï¼š**
    ```bash
    conda activate geneface_env
    ```

2.  **å¯åŠ¨ Flask æœåŠ¡å™¨ï¼š**
    ```bash
    python app.py
    ```
    æ‚¨å°†çœ‹åˆ°æœåŠ¡å™¨åœ¨ `http://127.0.0.1:5000` ä¸Šè¿è¡Œã€‚

3.  **è®¿é—®åº”ç”¨ï¼š**
    æ‰“å¼€æµè§ˆå™¨å¹¶è®¿é—® `http://127.0.0.1:5000`ã€‚

4.  **ä½¿ç”¨äººæœºå¯¹è¯åŠŸèƒ½ï¼š**
    a.  ç‚¹å‡» "äººæœºå¯¹è¯" æŒ‰é’®ã€‚
    b.  ç‚¹å‡» "å¼€å§‹å½•éŸ³"ï¼Œè¯´è¯ï¼Œç„¶åç‚¹å‡» "åœæ­¢å½•éŸ³"ã€‚
    c.  ç‚¹å‡» "ğŸ¤ å¼€å§‹å¯¹è¯" æŒ‰é’®ã€‚
    d.  ç­‰å¾…åç«¯å¤„ç†ï¼ˆASR -> LLM -> RVC -> æ‹¼æ¥ï¼‰ã€‚
    e.  å¤„ç†å®Œæˆåï¼ŒéŸ³é¢‘å°†è‡ªåŠ¨åœ¨ç½‘é¡µä¸Šæ’­æ”¾ã€‚